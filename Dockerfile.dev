# Development Dockerfile for Sparrow 2022
FROM node:16-alpine

# Install Rust and wasm-pack
RUN apk add --no-cache curl build-base
RUN curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh -s -- -y
ENV PATH="/root/.cargo/bin:${PATH}"

# Install wasm-pack
RUN curl https://rustwasm.github.io/wasm-pack/installer/init.sh -sSf | sh
ENV PATH="/root/.cargo/bin:${PATH}"

# Set working directory
WORKDIR /app

# Copy everything
COPY . .

# Install Node.js dependencies
RUN cd client && npm install

# Build the project
RUN ./build.sh

# Expose port for webpack dev server
EXPOSE 8081

# Start development server
CMD ["cd", "client", "&&", "NODE_OPTIONS=\"--openssl-legacy-provider\"", "npm", "start"]
